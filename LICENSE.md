موجّه (Prompt) مطابق للكود — Smart Money Algo Pro E5 (منفذ بايثون)

الدور: أنت مطوّر/منفّذ لنسخة بايثون من مؤشر Smart Money Algo Pro E5 – CHADBULL المطابقة للمنطق الأصلي في Pine، مع نفس ترتيب التنفيذ وإطلاق التنبيهات على شاشة المحرر.

المطلوب تنفيذُه (بدون إضافة أو حذف ميزات خارج ما في الكود):

1. التعرّف والتتبّع (بنفس النصوص تمامًا):

مربعات المناطق (Boxes) بعناوين نصّية الحرفيّة:

"IDM OB", "EXT OB", "Hist IDM OB", "Hist EXT OB", "Golden zone".


اللواصق/العلامات (Labels):

العلامة النصّية "X".

الدوائر وفق ألوان البُنى: الدوائر الحمراء (هبوط) والخضراء (صعود).


مستويات السيولة والاختراقات بحسب منطق PDH/PDL المدمج:

تنبيهات: "High Liquidity Level" و**"Low Liquidity Level"** عند الاكتشاف،

وتنبيهات: "High Liquidity Level Break" و**"Low Liquidity Level Break"** عند الكسر.




2. حالات المناطق كما في الكود (تُعرَض بالعربية على الشاشة):

منطقة جديدة، منطقة نشطة، تمت ملامستها، إعادة اختبار، محفوظة تاريخياً.

عند إنشاء IDM OB أو EXT OB أو Golden zone تُطلق تنبيهات Zone Created للعناوين:

"IDM OB Zone Created", "EXT OB Zone Created", "Golden Zone Created",

وتعرض الرسالة مع نطاق السعر bottom → top كما يحسبه الكود.




3. مفهوم “غير ملامَسة” المطابق للكود:

اعتبر المنطقة غير ملامَسة إذا كانت حالتها ليست تمت ملامستها ولا إعادة اختبار (أي ضمن منطقة جديدة أو منطقة نشطة وفق جدول الإحصاء الداخلي).
تمام—هذا «موجّه» (Prompt) جاهز للنسخ يطلب من النموذج إنشاء فاحص متعدد الأطر الزمنية يطابق أسلوب الكود الحالي (الطباعة إلى شاشة المحرّر/الكونسول فقط)، وبه مفتاح أعلى الملف للتفعيل/الإغلاق، ويمرّ على كل عملة في كل إطار:


---

موجّه إنشاء فاحص متعدد الأطر الزمنية (متوافق مع الكود الحالي)

الدور: أنت مطوّر تعدّل نفس ملف بايثون الحالي بدون تغيير أسلوب الإخراج.
المطلوب: إضافة فاحص يمرّ على كل رمز وعلى الأطر الزمنية المحددة ويطبع النتائج على شاشة المحرّر فقط — بلا حفظ ملفات إضافية.

1) مفاتيح أعلى الملف (Feature Flags)

أضِف في أعلى الملف (قرب مفاتيح التشغيل التلقائي الموجودة) المفاتيح التالية فقط:

MULTI_TF_SCAN_ENABLED = False        # تشغيل/إيقاف الفاحص متعدد الأطر
MULTI_TF_SCAN_TFS     = ["1m","5m","15m","1h","4h","1d"]  # الأطر المطلوبة

اجعل القيمة الافتراضية = False حتى لا يتغيّر سلوك التشغيل الحالي إلا عند التفعيل يدويًا.

لا تغيّر أي مفاتيح أو أسماء موجودة سابقًا.


2) دمج الفاحص مع مسار التنفيذ الحالي

لا تغيّر منطق الحسابات أو أسماء التنبيهات/الرسائل؛ فقط لفّ التنفيذ عبر حلقات الأطر.

في دوال التنفيذ الحالية داخل الـ Engine:

في run_backtest وrun_live (وبأي مسار مشابه يستدعي _run_series):

إذا كانت MULTI_TF_SCAN_ENABLED False ➜ اترك السلوك كما هو.

إذا كانت True ➜ بدلاً من تشغيل إطار واحد، نفّذ:

1. حلقة على كل رمز في self.cfg.symbols.


2. داخلها حلقة على كل إطار في MULTI_TF_SCAN_TFS.


3. اجلب الشموع لذلك الرمز بهذا الإطار (أعد استخدام دالة الجلب الحالية مع تمرير الإطار، أو أضف بارامتر timeframe لدالة الجلب إن لزم).


4. مرِّر السلسلة إلى مسار التحليل الحالي (نفس استدعاء _run_series/المحرّك).


5. اطبع رأسًا مختصرًا قبل نتائج كل إطار مثل:

=== {SYMBOL} | TF: {tf} | {#candles} شموع ===


6. أبقِ كل رسائل وتنسيقات الطباعة كما هي (تنبيهات المناطق/السيولة/الإشارات… إلخ) لتظهر أسفل الرأس لكل إطار.






> ملاحظة: لا تُنشئ ملفات JSON/CSV إضافية، ولا تغيّر منسوب التفاصيل المطبوعة؛ الهدف فقط تكرار نفس التحليل لكل إطار.



3) توافق مع التشغيل التلقائي وواجهة الأوامر

احترم مفاتيح التشغيل التلقائي الحالية (مثل التكرار والفاصل الزمني) بدون تعديل.

اختياري (بدون كسر التوافق): أضِف وسيطين لـ argparse دون تغيير الافتراضيات:

--multi-tf on|off (يُغلّب قيمة MULTI_TF_SCAN_ENABLED)

--tfs 1m,5m,15m,1h,4h,1d (يُغلّب MULTI_TF_SCAN_TFS)


إن لم تُمرَّر، اعمل بقيم أعلى الملف كما هي.


4) متطلبات الجلب لكل إطار

أعد استخدام نفس دوال الجلب الحالية (ccxt/CSV).

في الوضع الحي: استخدم نفس نافذة الجلب المعمول بها، ولا تغيّر عدد الشموع إلا إذا كان ذلك مطلوبًا لنجاح التحليل.

في الباك تست: احترم --start/--end (أو ما يقابلها) لكل إطار بدون تغيير تنسيق الطباعة.


5) معايير القبول

عند تفعيل MULTI_TF_SCAN_ENABLED=True:

يُطبع قسم مستقل لكل {رمز × إطار} بالترتيب: الرمز → الإطار → النتائج.

تظهر كل التنبيهات/الإشارات بنفس نصوص الكود الحالية وتلوين ANSI كما هي.

لا تُكتب أي ملفات إضافية؛ كله على شاشة المحرّر فقط.


عند إيقافه (False): يعود السلوك تمامًا كما كان قبل الإضافة.



---

> خلاصة: المطلوب إضافة حلقة أطر زمنية محكومة بمفتاح أعلى الملف، مع الحفاظ الصارم على أسماء الرسائل، أسلوب الطباعة، ومسارات التنفيذ الحالية؛ لا نُدخل أي تغييرات أخرى سوى تكرار التحليل لكل إطار ضمن القائمة المحددة.
